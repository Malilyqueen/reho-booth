<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue Projet - MaPocket</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
        }
        .close-modal {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .active-tab {
            color: #4F46E5;
            border-bottom: 2px solid #4F46E5;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .progressBar-bg {
            height: 8px;
            border-radius: 4px;
            background-color: #E4E4E7;
        }
        .progressBar-fill {
            height: 100%;
            border-radius: 4px;
        }
        .switchInterface {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <!-- Bouton pour basculer vers l'interface simple -->
    <div class="switchInterface">
        <button id="switchInterfaceBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-full shadow-lg">
            <i class="fas fa-exchange-alt mr-2"></i>Interface simple
        </button>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-6">
        <!-- HEADER -->
        <div class="flex justify-between items-center mb-6">
            <a href="index.html" id="btn-back-to-dashboard" class="text-gray-600 hover:text-gray-900">
                <i class="fas fa-arrow-left mr-2"></i>Retour au tableau de bord
            </a>
            <div class="flex space-x-2">
                <button class="btn-edit-project bg-blue-500 text-white px-4 py-2 rounded-xl hover:bg-blue-600 transition-colors">
                    <i class="fas fa-edit mr-2"></i>Modifier
                </button>
                <button class="btn-complete-project bg-green-500 text-white px-4 py-2 rounded-xl hover:bg-green-600 transition-colors">
                    <i class="fas fa-check mr-2"></i>Terminer
                </button>
                <button class="btn-archive-project bg-red-500 text-white px-4 py-2 rounded-xl hover:bg-red-600 transition-colors">
                    <i class="fas fa-archive mr-2"></i>Archiver
                </button>
            </div>
        </div>

        <!-- TITLE SECTION -->
        <div class="mb-6">
            <h1 id="projectTitle" class="text-3xl font-semibold text-gray-900 mb-1">Chargement du projet...</h1>
            <div class="flex items-center text-sm text-gray-500">
                <span>Type: </span>
                <span id="projectType" class="ml-1 font-medium">--</span>
                <span class="mx-2">•</span>
                <span id="projectStatus" class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">En cours</span>
            </div>
        </div>

        <!-- BUDGET STATUS -->
        <div class="bg-white rounded-xl p-5 shadow-md mb-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div>
                    <p class="text-xs text-gray-400">Date</p>
                    <p id="projectDate" class="font-medium text-lg">--/--/----</p>
                </div>
                <div>
                    <p class="text-xs text-gray-400">Budget initial</p>
                    <p id="initialBudget" class="font-medium text-lg">0,00 €</p>
                </div>
                <div>
                    <p class="text-xs text-gray-400">Utilisé</p>
                    <p id="usedBudget" class="font-medium text-lg">0,00 €</p>
                </div>
                <div>
                    <p class="text-xs text-gray-400">Écart</p>
                    <p id="budgetGap" class="font-medium text-lg text-green-600">0,00 €</p>
                </div>
                <div class="md:col-span-4">
                    <div class="flex justify-between items-center mb-1">
                        <p class="text-xs text-gray-400">Progression du budget</p>
                        <p id="budgetPercentage" class="text-xs font-medium">0%</p>
                    </div>
                    <div class="progressBar-bg">
                        <div id="progressBar" class="progressBar-fill bg-green-500" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TABS SECTION -->
        <div class="mb-6 border-b border-gray-200">
            <div class="flex space-x-8">
                <button class="tab-btn active-tab py-3 px-1 font-medium" data-tab="categories">Catégories</button>
                <button class="tab-btn py-3 px-1 font-medium text-gray-500 hover:text-gray-700" data-tab="real-tracking">Dépenses réelles</button>
                <button class="tab-btn py-3 px-1 font-medium text-gray-500 hover:text-gray-700" data-tab="attachments">Justificatifs</button>
                <button class="tab-btn py-3 px-1 font-medium text-gray-500 hover:text-gray-700" data-tab="comments">Commentaires</button>
            </div>
        </div>

        <!-- TAB CONTENT -->
        <div class="tab-content active" id="categories-tab">
            <div id="categoryList" class="space-y-6">
                <!-- Les catégories seront générées ici dynamiquement -->
                <p class="text-center py-8 text-gray-500">Chargement des catégories...</p>
            </div>
        </div>

        <div class="tab-content" id="real-tracking-tab">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">Dépenses réelles</h3>
                <button id="btnAddRealExpense" class="btn-add-real-expense bg-blue-500 text-white px-4 py-2 rounded-xl hover:bg-blue-600 transition-colors">
                    <i class="fas fa-plus mr-2"></i>Ajouter une dépense
                </button>
            </div>
            <div id="real-expenses-container" class="space-y-4">
                <!-- Les dépenses seront générées ici dynamiquement -->
                <p class="text-center py-8 text-gray-500">Aucune dépense réelle enregistrée</p>
            </div>
        </div>

        <div class="tab-content" id="attachments-tab">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">Justificatifs</h3>
                <button id="btnAddAttachment" class="bg-blue-500 text-white px-4 py-2 rounded-xl hover:bg-blue-600 transition-colors">
                    <i class="fas fa-plus mr-2"></i>Ajouter un justificatif
                </button>
            </div>
            <div id="attachments-container" class="space-y-4">
                <!-- Les pièces jointes seront générées ici dynamiquement -->
                <p class="text-center py-8 text-gray-500">Aucun justificatif enregistré</p>
            </div>
        </div>

        <div class="tab-content" id="comments-tab">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">Commentaires</h3>
                <button id="btnAddComment" class="bg-blue-500 text-white px-4 py-2 rounded-xl hover:bg-blue-600 transition-colors">
                    <i class="fas fa-plus mr-2"></i>Ajouter un commentaire
                </button>
            </div>
            <div id="comments-container" class="space-y-4">
                <!-- Les commentaires seront générés ici dynamiquement -->
                <p class="text-center py-8 text-gray-500">Aucun commentaire enregistré</p>
            </div>
        </div>

        <!-- FOOTER -->
        <div class="mt-12 text-center text-sm text-gray-400">
            © 2025 MaPocket • Gestion budgétaire intelligente
        </div>
    </div>

    <!-- TEMPLATE POUR UNE CATÉGORIE -->
    <template id="category-template">
        <div class="category bg-white shadow-md rounded-xl p-5 overflow-hidden">
            <div class="flex justify-between items-center mb-3">
                <h2 class="text-xl font-semibold category-title flex items-center">
                    <span class="category-emoji mr-2"></span>
                    <span class="category-name"></span>
                </h2>
                <span class="text-sm font-medium text-gray-600 category-amount"></span>
            </div>
            <div class="subcategories-container ml-4 space-y-3">
                <!-- Sous-catégories générées ici -->
            </div>
        </div>
    </template>

    <!-- TEMPLATE POUR UNE SOUS-CATÉGORIE -->
    <template id="subcategory-template">
        <div class="subcategory">
            <div class="flex justify-between items-center mb-2">
                <h3 class="text-md font-medium subcategory-title flex items-center">
                    <span class="subcategory-emoji mr-2"></span>
                    <span class="subcategory-name"></span>
                </h3>
                <span class="text-sm text-gray-500 subcategory-amount"></span>
            </div>
            <ul class="expense-lines ml-8 text-sm list-disc text-gray-700 space-y-1">
                <!-- Lignes de dépenses générées ici -->
            </ul>
        </div>
    </template>

    <!-- TEMPLATE POUR UNE LIGNE DE DÉPENSE -->
    <template id="expense-line-template">
        <li class="expense-line flex justify-between">
            <span class="expense-name"></span>
            <span class="expense-amount ml-4 text-gray-600"></span>
        </li>
    </template>

    <!-- Modales pour les différentes actions -->
    <div id="realExpenseModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 class="text-xl font-semibold mb-4">Ajouter une dépense réelle</h2>
            <form id="real-expense-form" class="space-y-4">
                <div>
                    <label for="expenseDate" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                    <input type="date" id="expenseDate" required class="w-full p-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label for="expenseCategory" class="block text-sm font-medium text-gray-700 mb-1">Catégorie</label>
                    <select id="expenseCategory" required class="w-full p-2 border border-gray-300 rounded-md">
                        <!-- Les catégories seront générées ici dynamiquement -->
                    </select>
                </div>
                <div>
                    <label for="expenseAmount" class="block text-sm font-medium text-gray-700 mb-1">Montant</label>
                    <input type="number" id="expenseAmount" step="0.01" min="0" required class="w-full p-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label for="expenseDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea id="expenseDescription" rows="3" class="w-full p-2 border border-gray-300 rounded-md"></textarea>
                </div>
                <div class="flex justify-end space-x-2 pt-2">
                    <button type="button" id="cancelExpenseBtn" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">Annuler</button>
                    <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded-md text-sm font-medium hover:bg-blue-600">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <div id="attachmentModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 class="text-xl font-semibold mb-4">Ajouter un justificatif</h2>
            <form id="attachment-form" class="space-y-4">
                <div>
                    <label for="attachmentName" class="block text-sm font-medium text-gray-700 mb-1">Nom</label>
                    <input type="text" id="attachmentName" required class="w-full p-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label for="attachmentFile" class="block text-sm font-medium text-gray-700 mb-1">Fichier</label>
                    <input type="file" id="attachmentFile" required class="w-full p-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label for="attachmentDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea id="attachmentDescription" rows="3" class="w-full p-2 border border-gray-300 rounded-md"></textarea>
                </div>
                <div class="flex justify-end space-x-2 pt-2">
                    <button type="button" id="cancelAttachmentBtn" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">Annuler</button>
                    <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded-md text-sm font-medium hover:bg-blue-600">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <div id="commentModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 class="text-xl font-semibold mb-4">Ajouter un commentaire</h2>
            <form id="comment-form" class="space-y-4">
                <div>
                    <label for="commentAuthor" class="block text-sm font-medium text-gray-700 mb-1">Votre nom</label>
                    <input type="text" id="commentAuthor" required class="w-full p-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label for="commentContent" class="block text-sm font-medium text-gray-700 mb-1">Commentaire</label>
                    <textarea id="commentContent" rows="5" required class="w-full p-2 border border-gray-300 rounded-md"></textarea>
                </div>
                <div class="flex justify-end space-x-2 pt-2">
                    <button type="button" id="cancelCommentBtn" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">Annuler</button>
                    <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded-md text-sm font-medium hover:bg-blue-600">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/currencies.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/budget-type-fix.js"></script>
    <script src="js/modern-project-renderer.js"></script>
    <script src="js/project-detail.js"></script>
    <script src="js/editable-project.js"></script>
    <script src="js/inline-edit-project.js"></script>
    <script>
        // Bouton pour basculer vers l'interface simple
        document.getElementById('switchInterfaceBtn').addEventListener('click', function() {
            // Redirection vers l'interface simple
            localStorage.removeItem('useClassicInterface'); // S'assurer que le flag est supprimé
            window.location.href = 'projet-vue-simple.html';
        });

        // Script de gestion des onglets (tabs)
        document.addEventListener('DOMContentLoaded', function() {
            // Gestion des onglets
            const tabs = document.querySelectorAll('.tab-btn');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Supprimer la classe active de tous les onglets
                    tabs.forEach(t => {
                        t.classList.remove('active-tab');
                        t.classList.add('text-gray-500');
                    });
                    
                    // Ajouter la classe active à l'onglet cliqué
                    this.classList.add('active-tab');
                    this.classList.remove('text-gray-500');
                    
                    // Masquer tous les contenus d'onglets
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Afficher le contenu correspondant à l'onglet
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId + '-tab').classList.add('active');
                });
            });
        });
    </script>
</body>
</html>